generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model attachments {
  id         BigInt   @id @default(autoincrement())
  task_id    BigInt
  user_id    BigInt?
  filename   String   @db.VarChar(255)
  file_url   String   @db.VarChar(500)
  file_size  BigInt?
  mime_type  String?  @db.VarChar(100)
  created_at DateTime @default(now()) @db.Timestamptz(6)
  tasks      tasks    @relation(fields: [task_id], references: [id], onDelete: Cascade)
  users      users?   @relation(fields: [user_id], references: [id])

  @@index([task_id])
}

model board_members {
  id        BigInt    @id @default(autoincrement())
  board_id  BigInt
  user_id   BigInt
  role      BoardRole @default(member)
  joined_at DateTime  @default(now()) @db.Timestamptz(6)
  boards    boards    @relation(fields: [board_id], references: [id], onDelete: Cascade)
  users     users     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([board_id, user_id])
  @@index([board_id])
  @@index([user_id])
}

model boards {
  id               BigInt          @id @default(autoincrement())
  uuid             String          @unique @db.Uuid
  title            String          @db.VarChar(255)
  description      String?
  owner_id         BigInt
  background_color String          @default("#ffffff") @db.VarChar(7)
  is_archived      Boolean         @default(false)
  created_at       DateTime        @default(now()) @db.Timestamptz(6)
  updated_at       DateTime        @db.Timestamptz(6)
  board_members    board_members[]
  users            users           @relation(fields: [owner_id], references: [id], onDelete: Cascade)
  columns          columns[]
  labels           labels[]
  tasks            tasks[]
}

model columns {
  id          BigInt   @id @default(autoincrement())
  uuid        String   @unique @db.Uuid
  board_id    BigInt
  title       String   @db.VarChar(255)
  position    Int
  color       String?  @db.VarChar(7)
  is_archived Boolean  @default(false)
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  updated_at  DateTime @db.Timestamptz(6)
  boards      boards   @relation(fields: [board_id], references: [id], onDelete: Cascade)
  tasks       tasks[]

  @@unique([board_id, position])
  @@index([board_id])
  @@index([board_id, position])
}

model comments {
  id         BigInt   @id @default(autoincrement())
  task_id    BigInt
  user_id    BigInt
  content    String
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @db.Timestamptz(6)
  tasks      tasks    @relation(fields: [task_id], references: [id], onDelete: Cascade)
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([task_id])
}

model labels {
  id          BigInt        @id @default(autoincrement())
  board_id    BigInt
  name        String        @db.VarChar(100)
  color       String        @db.VarChar(7)
  created_at  DateTime      @default(now()) @db.Timestamptz(6)
  boards      boards        @relation(fields: [board_id], references: [id], onDelete: Cascade)
  task_labels task_labels[]

  @@unique([board_id, name])
}

model refresh_tokens {
  id         BigInt    @id @default(autoincrement())
  user_id    BigInt
  token      String    @unique @db.VarChar(500)
  expires_at DateTime  @db.Timestamptz(6)
  is_revoked Boolean   @default(false)
  ip_address String?   @db.VarChar(45)
  user_agent String?   @db.VarChar(500)
  created_at DateTime  @default(now()) @db.Timestamptz(6)
  revoked_at DateTime? @db.Timestamptz(6)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([expires_at])
  @@index([token])
  @@index([user_id])
}

model task_labels {
  id         BigInt   @id @default(autoincrement())
  task_id    BigInt
  label_id   BigInt
  created_at DateTime @default(now()) @db.Timestamptz(6)
  labels     labels   @relation(fields: [label_id], references: [id], onDelete: Cascade)
  tasks      tasks    @relation(fields: [task_id], references: [id], onDelete: Cascade)

  @@unique([task_id, label_id])
  @@index([label_id])
  @@index([task_id])
}

model tasks {
  id                             BigInt        @id @default(autoincrement())
  uuid                           String        @unique @db.Uuid
  board_id                       BigInt
  column_id                      BigInt
  title                          String        @db.VarChar(500)
  description                    String?
  position                       Decimal       @db.Decimal(10, 5)
  priority                       TaskPriority  @default(medium)
  due_date                       DateTime?     @db.Timestamptz(6)
  created_by                     BigInt?
  assigned_to                    BigInt?
  is_archived                    Boolean       @default(false)
  created_at                     DateTime      @default(now()) @db.Timestamptz(6)
  updated_at                     DateTime      @db.Timestamptz(6)
  attachments                    attachments[]
  comments                       comments[]
  task_labels                    task_labels[]
  users_tasks_assigned_toTousers users?        @relation("tasks_assigned_toTousers", fields: [assigned_to], references: [id])
  boards                         boards        @relation(fields: [board_id], references: [id], onDelete: Cascade)
  columns                        columns       @relation(fields: [column_id], references: [id], onDelete: Cascade)
  users_tasks_created_byTousers  users?        @relation("tasks_created_byTousers", fields: [created_by], references: [id])

  @@index([assigned_to])
  @@index([board_id, column_id])
  @@index([board_id])
  @@index([column_id])
  @@index([column_id, position])
}

model users {
  id                             BigInt           @id @default(autoincrement())
  uuid                           String           @unique @db.Uuid
  email                          String           @unique @db.VarChar(255)
  username                       String           @unique @db.VarChar(100)
  password_hash                  String           @db.VarChar(255)
  full_name                      String?          @db.VarChar(255)
  avatar_url                     String?          @db.VarChar(500)
  created_at                     DateTime         @default(now()) @db.Timestamptz(6)
  updated_at                     DateTime         @db.Timestamptz(6)
  activation_link                String?          @db.VarChar(255)
  is_activated                   Boolean          @default(false)
  attachments                    attachments[]
  board_members                  board_members[]
  boards                         boards[]
  comments                       comments[]
  refresh_tokens                 refresh_tokens[]
  tasks_tasks_assigned_toTousers tasks[]          @relation("tasks_assigned_toTousers")
  tasks_tasks_created_byTousers  tasks[]          @relation("tasks_created_byTousers")
}

enum BoardRole {
  owner
  admin
  member
  viewer
}

enum TaskPriority {
  low
  medium
  high
  urgent
}
